{#
  Tab Component Macro

  A reusable component for creating server-side tab navigation with content rendering.
  Supports passing data to partials for dynamic content display.

  Features:
  - Server-side tab navigation using MOJ Design System
  - Data passing to included partials for dynamic content
  - JavaScript-ready with data attributes
  - Fallback content for tabs without partials

  Usage:
  {% from "components/tabComponent.njk" import tabComponent %}

  {{ tabComponent({
    activeTab: activeTab,
    containerId: "cases-tab-container",
    data: data,
    sortOrder: sortOrder,
    pagination: pagination,
    caseType: caseType,
    tabs: [
      {
        id: "new",
        text: "New",
        href: "/cases/new",
        partial: "cases/_new-partial.njk"
      },
      {
        id: "opened",
        text: "Opened",
        href: "/cases/opened",
        partial: "cases/_opened-partial.njk"
      }
    ]
  }) }}

  Options:
  - activeTab: Current active tab ID
  - containerId: HTML ID for the tab container
  - data: Data array to pass to partials (optional)
  - sortOrder: Sort order to pass to partials (optional)
  - pagination: Pagination metadata to pass to partials (optional)
  - tabs: Array of tab configuration objects:
    * id: Unique tab identifier
    * text: Display text for navigation
    * href: URL for tab navigation
    * partial: Path to Nunjucks partial template (optional)
    * content: Direct HTML content (optional, alternative to partial)

#}

{%- from "moj/components/sub-navigation/macro.njk" import mojSubNavigation -%}

{% macro tabComponent(options) %}
  {# Build valid tab ids #}
  {% set tabIds = [] %}
  {% for tab in options.tabs %}
    {% set tabIds = (tabIds.push(tab.id), tabIds) %}
  {% endfor %}

  {# Safe active id fallback #}
  {% set activeId = options.activeTab %}
  {% if not (activeId in tabIds) %}
    {% set activeId = options.tabs[0].id %}
  {% endif %}

  {# Build navigation items from tabs configuration #}
  {% set navItems = [] %}
  {% for tab in options.tabs %}
    {% set navItems = (navItems.push({
      text: tab.text,
      href: tab.href,
      active: (activeId == tab.id)
    }), navItems) %}
  {% endfor %}

  {# Render the MOJ sub-navigation #}
  {{ mojSubNavigation({
    label: "Sub navigation",
    items: navItems
  }) }}

  {# Render only the active tab content container with data attributes for JavaScript #}
  <div id="{{ options.containerId }}" class="tab-content-container" data-active-tab="{{ activeId }}">
    {% if options.showStatusHeading %}
      <h2 class="govuk-heading-m">{{ t('common.status.' + options.caseType) }}</h2>
    {% endif %}
    {% for tab in options.tabs %}
      <div class="tab-content {% if activeId == tab.id %}show{% endif %}" data-tab-id="{{ tab.id }}">
        {% if activeId == tab.id %}
          {# Set context variables for the partial #}
          {% set data = options.data %}
          {% set history = options.history %} 
          {% set sortOrder = options.sortOrder %}
          {% set pagination = options.pagination %}
          {% set timelineItems = options.timelineItems %}
          {% set caseType = options.caseType %}
          {% set csrfToken = options.csrfToken %}
          {% set maxProviderNoteLength = options.maxProviderNoteLength %}
          {% set characterThreshold = options.characterThreshold %}
          {% set currentProviderNote = options.currentProviderNote %}
          {% set caseReference = options.caseReference %}
          {% set error = options.error %}
          {% if tab.partial %}
            {% include tab.partial %}
          {% elif tab.content %}
            {{ tab.content | safe }}
          {% else %}
            <div class="govuk-body">
              <p>Content for {{ tab.text }} tab</p>
            </div>
          {% endif %}
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% endmacro %}