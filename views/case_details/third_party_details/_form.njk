{# Third Party Details Form Partial #}
{# This partial expects the following variables to be set in the parent template: #}
{# - caseReference: The case reference #}
{# - csrfToken: CSRF token #}
{# - formAction: The form action URL #}
{# - error: Error object (optional) #}
{# - current* variables: Current form values #}

{% if error %}
  {% set errorMessages = {
    thirdPartyFullName: { text: error.inputErrors.thirdPartyFullName } if error.inputErrors.thirdPartyFullName,
    thirdPartyEmailAddress: { text: error.inputErrors.thirdPartyEmailAddress } if error.inputErrors.thirdPartyEmailAddress,
    thirdPartyContactNumber: { text: error.inputErrors.thirdPartyContactNumber } if error.inputErrors.thirdPartyContactNumber,
    thirdPartySafeToCall: { text: error.inputErrors.thirdPartySafeToCall } if error.inputErrors.thirdPartySafeToCall,
    thirdPartyAddress: { text: error.inputErrors.thirdPartyAddress } if error.inputErrors.thirdPartyAddress,
    thirdPartyPostcode: { text: error.inputErrors.thirdPartyPostcode } if error.inputErrors.thirdPartyPostcode,
    thirdPartyRelationshipToClient: { text: error.inputErrors.thirdPartyRelationshipToClient } if error.inputErrors.thirdPartyRelationshipToClient,
    thirdPartyPassphraseSetUp: { text: error.inputErrors.thirdPartyPassphraseSetUp } if error.inputErrors.thirdPartyPassphraseSetUp,
    thirdPartyPassphrase: { text: error.inputErrors.thirdPartyPassphrase } if error.inputErrors.thirdPartyPassphrase
  } %}
{% endif %}

<form method="post" action="{{ formAction }}" autocomplete="off">
  <input type="hidden" name="_csrf" value="{{ csrfToken }}">

  <h3 class="govuk-heading-s">{{ t('pages.caseDetails.clientDetails.contactDetails') }}</h3>
  {{ govukInput({
    label: {
      text: t('forms.clientDetails.thirdParty.name'),
      classes: "govuk-text--m"
    },
    id: "thirdPartyFullName",
    name: "thirdPartyFullName",
    value: currentThirdPartyFullName,
    errorMessage: errorMessages.thirdPartyFullName if error
  }) }}

  {{ govukInput({
    label: {
      text: t('forms.clientDetails.thirdParty.phoneNumberHeading'),
      classes: "govuk-text--m"
    },
    errorMessage: errorMessages.thirdPartyContactNumber if error,
    id: "thirdPartyContactNumber",
    name: "thirdPartyContactNumber",
    type: "tel",
    classes: "govuk-input--width-20",
    value: currentThirdPartyContactNumber
  }) }}

  {{ govukRadios({
    name: "thirdPartySafeToCall",
    value: currentThirdPartySafeToCall,
    errorMessage: errorMessages.thirdPartySafeToCall if error,
    fieldset: {
      legend: {
        text: t('forms.clientDetails.thirdParty.safeToCallHeading'),
        classes: "govuk-text--m"
      }
    },
    items: [
      {
        value: "true",
        text: t('common.yes')
      },
      {
        value: "false",
        text: t('common.no')
      }
    ]
  }) }}

  {{ govukInput({
    label: {
      text: t('forms.clientDetails.thirdParty.emailAddressHeading'),
      classes: "govuk-text--m"
    },
    id: "thirdPartyEmailAddress",
    name: "thirdPartyEmailAddress",
    spellcheck: false,
    value: currentThirdPartyEmailAddress,
    errorMessage: errorMessages.thirdPartyEmailAddress if error
  }) }}

  {{ govukTextarea({
    label: {
      text: t('forms.clientDetails.thirdParty.addressHeading'),
      classes: "govuk-text--m"
    },
    id: "thirdPartyAddress",
    name: "thirdPartyAddress",
    value: currentThirdPartyAddress,
    errorMessage: errorMessages.thirdPartyAddress if error,
    autocomplete: "off"
  }) }}

  {{ govukInput({
    label: {
      text: t('forms.clientDetails.thirdParty.postcodeHeading'),
      classes: "govuk-text--m"
    },
    id: "thirdPartyPostcode",
    name: "thirdPartyPostcode",
    classes: "govuk-input--width-10",
    value: currentThirdPartyPostcode,
    errorMessage: errorMessages.thirdPartyPostcode if error,
    autocomplete: "off"
  }) }}

  {{ govukRadios({
    name: "thirdPartyRelationshipToClient",
    value: currentThirdPartyRelationshipToClient,
    errorMessage: errorMessages.thirdPartyRelationshipToClient if error,
    fieldset: {
      legend: {
        text: t('forms.clientDetails.thirdParty.relationshipToClient.title'),
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: t('common.thirdPartyRelationship.value.PARENT_GUARDIAN'),
        text: t('common.thirdPartyRelationship.text.PARENT_GUARDIAN')
      },
      {
        value: t('common.thirdPartyRelationship.value.FAMILY_FRIEND'),
        text: t('common.thirdPartyRelationship.text.FAMILY_FRIEND')
      },
      {
        value: t('common.thirdPartyRelationship.value.PROFESSIONAL'),
        text: t('common.thirdPartyRelationship.text.PROFESSIONAL')
      },
      {
        value: t('common.thirdPartyRelationship.value.LEGAL_ADVISOR'),
        text: t('common.thirdPartyRelationship.text.LEGAL_ADVISOR')
      },
      {
        value: t('common.thirdPartyRelationship.value.OTHER'),
        text: t('common.thirdPartyRelationship.text.OTHER')
      }
    ]
  }) }}

  {% set passphraseInput %}
    {{ govukInput({
      id: "thirdPartyPassphrase",
      name: "thirdPartyPassphrase",
      value: currentThirdPartyPassphrase,
      spellcheck: false,
      classes: "govuk-!-width-one-half",
      label: {
        text: t('forms.clientDetails.thirdParty.passphrase.passphraseHint')
      },
      errorMessage: errorMessages.thirdPartyPassphrase if error
    }) }}
  {% endset -%}

  {{ govukRadios({
    name: "thirdPartyPassphraseSetUp",
    value: currentThirdPartyPassphraseSetUp,
    errorMessage: errorMessages.thirdPartyPassphraseSetUp if error,
    fieldset: {
      legend: {
        text: t('forms.clientDetails.thirdParty.passphrase.titleH2'),
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: t('common.yes'),
        text: t('common.yes'),
        conditional: {
          html: passphraseInput
        }
      },
      {
        divider: "or"
      },
      {
        value: t('common.thirdPartyReason.value.CHILD_PATIENT'),
        text: t('common.thirdPartyReason.text.CHILD_PATIENT')
      },
      {
        value: t('common.thirdPartyReason.value.POWER_ATTORNEY'),
        text: t('common.thirdPartyReason.text.POWER_ATTORNEY')
      },
      {
        value: t('common.thirdPartyReason.value.NO_TELEPHONE_DISABILITY'),
        text: t('common.thirdPartyReason.text.NO_TELEPHONE_DISABILITY')
      },
      {
        value: t('common.thirdPartyReason.value.NO_TELEPHONE_LANGUAGE'),
        text: t('common.thirdPartyReason.text.NO_TELEPHONE_LANGUAGE')
      },
      {
        value: t('common.thirdPartyReason.value.OTHER'),
        text: t('common.thirdPartyReason.text.OTHER')
      }
    ]
  }) }}

  <div class="govuk-button-group">
    {{ govukButton({
      text: t('common.save')
    }) }}
    <a class="govuk-link" href="{{ backLinkHref }}">{{ t('common.cancel') }}</a>
  </div>
</form>
