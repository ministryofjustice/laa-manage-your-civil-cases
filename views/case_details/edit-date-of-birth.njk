{% extends "base.njk" %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% block pageTitle %}
  {% if errorState.hasErrors %}{{ t.common.error }}: {% endif %}{{ pageTitle or t.forms.clientDetails.dateOfBirth.pageTitle | replace('{caseReference}', caseReference) | replace('{serviceName}', config.SERVICE_NAME) }}
{% endblock %}

{% block backLink %}
  {{ govukBackLink({
      text: t.common.back,
      href: "/cases/" + caseReference + "/client-details",
      classes: "govuk-!-margin-bottom-0"
    }) }}
{% endblock %}

{% block pageContent %}
  
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      
      {% if errorState.hasErrors %}
        {{ govukErrorSummary({
          titleText: t.common.errorSummaryTitle,
          errorList: errorState.errors
        }) }}
      {% endif %}
      
      <form method="POST" action="/cases/{{ caseReference }}/client-details/change/date-of-birth">
        
        <!-- CSRF Protection -->
        <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
        
        <!-- Original values for change detection -->
        <input type="hidden" name="originalDay" value="{{ originalData.day }}" />
        <input type="hidden" name="originalMonth" value="{{ originalData.month }}" />
        <input type="hidden" name="originalYear" value="{{ originalData.year }}" />
        
        {{ govukDateInput({
          id: "dateOfBirth",
          namePrefix: "dateOfBirth",
          fieldset: {
            legend: {
              text: t.forms.clientDetails.dateOfBirth.legend,
              isPageHeading: true,
              classes: "govuk-fieldset__legend--l govuk-!-margin-bottom-6"
            }
          },
          hint: {
            text: t.forms.clientDetails.dateOfBirth.hint
          },
          errorMessage: {
            html: inlineErrorMessage | replace('\n', '<br>')
          } if inlineErrorMessage,
          items: [
            {
              name: "day",
              classes: "govuk-input--width-2" + (" govuk-input--error" if highlightDay),
              value: formData.day,
              attributes: {
                "aria-describedby": "dateOfBirth-error" if highlightDay,
                "autocomplete": "off"
              }
            },
            {
              name: "month", 
              classes: "govuk-input--width-2" + (" govuk-input--error" if highlightMonth),
              value: formData.month,
              attributes: {
                "aria-describedby": "dateOfBirth-error" if highlightMonth,
                "autocomplete": "off"
              }
            },
            {
              name: "year",
              classes: "govuk-input--width-4" + (" govuk-input--error" if highlightYear),
              value: formData.year,
              attributes: {
                "aria-describedby": "dateOfBirth-error" if highlightYear,
                "autocomplete": "off"
              }
            }
          ]
        }) }}

        <div class="govuk-button-group">
          {{ govukButton({
            text: t.common.save
          }) }}
          <a class="govuk-link" href="/cases/{{ caseReference }}/client-details">{{ t.common.cancel }}</a>
        </div>

        
      </form>
      
    </div>
  </div>
{% endblock %}